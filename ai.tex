
\chapter{Interpretazione astratta}

[Introduzione al capitolo da scrivere.]

\section{Analisi dei segni per WHILE}

\subsection{Dominio concreto}

Le variabili del linguaggio WHILE possono contenere solamente numeri interi,
il che giustifica il fatto che il dominio concreto dell'interpretazione
astratta che andiamo a definire è
\[
  \bigl(\wp(\Zset), \subseteq\bigr).
\]

\subsection{Dominio astratto}

Il dominio astratto $\Sign$ cattura semplici relazioni rispetto al
numero $0$, ad esempio $\cdot < 0$, $\cdot = 0$, \dots
L'ordinamento del dominio è indicato nel diagramma di Hasse di
figura~\ref{fig:ordering-rels-lattice}.

\begin{figure}
\begin{center}
\setlength{\unitlength}{1.8mm}
\begin{picture}(28, 40)
{\thicklines
\put(14, 2){\circle{4}}
\put(14, 2){\makebox(0, 0){$\signbot$}}

\put( 2, 14){\circle{4}}
\put( 2, 14){\makebox(0, 0){$\signlt$}}
\put(14, 14){\circle{4}}
\put(14, 14){\makebox(0, 0){$\signeq$}}
\put(26, 14){\circle{4}}
\put(26, 14){\makebox(0, 0){$\signgt$}}

\put( 2, 26){\circle{4}}
\put( 2, 26){\makebox(0, 0){$\signle$}}
\put(14, 26){\circle{4}}
\put(14, 26){\makebox(0, 0){$\signne$}}
\put(26, 26){\circle{4}}
\put(26, 26){\makebox(0, 0){$\signge$}}

\put(14, 38){\circle{4}}
\put(14, 38){\makebox(0, 0){$\signtop$}}

\put( 2, 24){\line(0, -1){8}}
\put(26, 24){\line(0, -1){8}}

\put(14, 36){\line(0, -1){8}}
\put(14, 12){\line(0, -1){8}}

\put(15.42, 36.58){\line(1, -1){9.16}}
\put( 3.42, 24.58){\line(1, -1){9.16}}
\put(15.42, 24.58){\line(1, -1){9.16}}
\put( 3.42, 12.58){\line(1, -1){9.16}}

\put( 3.42, 27.42){\line(1, 1){9.16}}
\put( 3.42, 15.42){\line(1, 1){9.16}}
\put(15.42, 15.42){\line(1, 1){9.16}}
\put(15.42,  3.42){\line(1, 1){9.16}}
}
\end{picture}
\end{center}
\caption{Diagramma di Hasse del dominio $\Sign$.}
\label{fig:ordering-rels-lattice}
\end{figure}


\subsection{Funzione di concretizzazione}

La funzione di concretizzazione definisce la semantica di ogni
elemento di $\Sign$.
\begin{definizione} \summary{($\fund{\gamma}{\Sign}{\wp(\Zset)}$.)}
La funzione $\fund{\gamma}{\Sign}{\wp(\Zset)}$ è definita
da:
\begin{align*}
  \gamma(\top) &= \Zset, \\
  \gamma(\bot) &= \emptyset, \\
  \gamma(\bowtie) &= \{\, n \in \Zset \mid n \bowtie 0 \,\},
    \quad\text{per $\bowtie \in \{ \leq, \neq, \geq, <, =, > \}$.}
\end{align*}
\end{definizione}

\begin{proposizione}
La funzione $\gamma$ è monotona.
\end{proposizione}
\begin{proof}
	$ \gamma(\bot) = \o \subseteq \gamma(a) , \forall a \in A $ \\
	$ \gamma(=) = \{0\} \subseteq \gamma(\geq) $ \\
	$ \gamma(a) \subseteq \Zset = \gamma(\top), \forall a \in A $
\end{proof}

\subsection{Funzione di astrazione}

\begin{definizione} \summary{($\fund{\alpha}{\wp(\Zset)}{\Sign}$.)}
La funzione $\fund{\alpha}{\wp(\Zset)}{\Sign}$ viene definita attraverso
la funzione $\beta$:
\[
	\fund{\beta}{\Zset}{\Sign}
\]
che si comporta nel seguente modo:
\begin{align*}
	\forall n \in \Zset: \beta(n) &=
	\begin{cases}
		>,	&\text{se $n  >  0$;} \\
		=,	&\text{se $n = 0$;} \\
		<,	&\text{se $n < 0$.}
	\end{cases} 
\end{align*}
Quindi, la funzione $\alpha$ rappresenta il $\lub$ della
funzione $\beta$ applicata ad ogni elemento di $S$:
\[
	\forall S \in \wp(\Zset) : \alpha(S) = \sqcup \{\, \beta(n) \mid n \in S \,\}
\]
Questo fatto giustifica le approssimazioni compiute nel processo
di astrazione.
\end{definizione}

\begin{proposizione}
La funzione $\alpha$ è monotona.
\end{proposizione}
\begin{proof}
	$ \forall S_1, S_2 \in \wp(\Zset) : S_1 \subseteq S_2 \Rightarrow \alpha(S_1) \sqsubseteq \alpha(S_2)\text{;} $ \\
	$ S_1 \subseteq S_2 \Rightarrow \beta(S_1) \subseteq \beta(S_2) \text{, perché } \beta \text{ è  una funzione;} $ \\
	$ \alpha(S_1) = \alpha(S_2) \text{per proprietà del lub.} $
\end{proof}

\subsection{Inserzione di Galois}

\begin{proof}
Siamo in un'inserzione di Galois? Il primo passo da verificare è che $\compfun{\gamma}{\alpha}$ è estensiva. 
\begin{align*}
	\forall S \in \calP(\Zset) : \compfun{\gamma}{\alpha}(S) &\supseteq S \\
	\gamma\bigl(\alpha(S)\bigr) &\supseteq S \\
	\gamma\bigl(\sqcup \{\, \beta(n) \mid n \in S \,\} \bigr) &\supseteq S
\end{align*}
Consideriamo $\gamma$ additiva: dovremmo prendere i vari casi e
dimostrare che, ad esempio, l'unione fra
$\gamma(=)$ e $\gamma(<)$ è $\gamma(\leq)$.
Questo perché l'unione è il lub di quell'insieme:
\[
	\union \{\, \gamma\bigl(\beta(n)\bigr) \mid n \in \Zset \,\} \supseteq S
\]
Per dimostrarlo possiamo sfuttare il lemma:
\begin{lemma}
	$ \forall n \in \Zset : n \in \gamma\bigl(\beta(n)\bigr) $
\end{lemma}
Facendo i vari casi, questo completa la dimostrazione.
\end{proof}

\begin{proof}
Infine, mostriamo banalmente che $\compfun{\alpha}{\gamma}$ corrisponde all'identità:
\begin{align*}
	\compfun{\alpha}{\gamma}(\bot) &= \bot \\
	\compfun{\alpha}{\gamma}(\top) &= \top \\
	\compfun{\alpha}{\gamma}(\geq) &= \geq
\end{align*}
\end{proof}

\subsection{Operazioni astratte}
Le operazioni astratte vanno definite seguendo le operazioni concrete;
esse si applicano tra elementi del dominio astratto.
Descriviamo in seguito le operazioni più interessanti applicabili
al nostro dominio astratto.

\begin{definizione}\summary{Moltiplicazione astratta}
La moltiplicazione astratta è definita come segue:
\[
	\absmul = \lambda a_1,a_2 \in A . \alpha\bigl(\gamma(a_1) \conmul \gamma(a_2)\bigr)
\]
con $\conmul$ moltiplicazione concreta, definita come segue:
\[
	S_1 \conmul S_2 = \{\, n_1 * n_2 \mid n_1 \in S_1, n_2 \in S_2 \,\}
\]
\end{definizione}

\begin{center}
	\begin{tabular}{ c | c c c c c c c c }
		$\absmul$ & $\top$ & $\leq$ & $\neq$ & $\geq$ & $<$ & $=$ & $>$ & $\bot$ \\
		\hline
		$\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $=$ & $\top$ & $\bot$  \\
		$\leq$ & $\top$ & $\geq$ & $\top$ & $\leq$ & $\geq$ & $=$ & $\leq$ & $\bot$\\
		$\neq$ & $\top$ & $\top$ & $\neq$ & $\top$ & $\neq$ & $=$ & $\neq$ & $\bot$ \\
		$\geq$ & $\top$ & $\leq$ & $\top$ & $\geq$ & $\leq$ & $=$ & $\geq$ & $\bot$ \\
		$<$ & $\top$ & $\geq$ & $\neq$ & $\leq$ & $>$ & $=$ & $<$ & $\bot$ \\
		$=$ & $=$ & $=$ & $=$ & $=$ & $=$ & $=$ & $=$ & $\bot$\\
		$>$ & $\top$ & $\leq$ & $\neq$ & $\geq$ & $<$ & $=$ & $>$ & $\bot$\\
		$\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ \\
	\end{tabular}
\end{center}

Come si può notare, la tabella risultante è simmetrica:
questo perché l'operatore di moltiplicazione astratta è commutativo.

\begin{definizione}\summary{Somma astratta}
La somma astratta è definita come segue:
\[
	\absadd = \lambda a_1,a_2 \in A . \alpha\bigl(\gamma(a_1) \conadd \gamma(a_2)\bigr)
\]
con $\conadd$ somma concreta, definita come segue:

\[
	S_1 \conadd S_2 = \{\, n_1 + n_2 \mid n_1 \in S_1, n_2 \in S_2 \,\}
\]
\end{definizione}

\begin{center}
	\begin{tabular}{c | c c c c c c c c}
		$\absadd$ & $\top$ & $\leq$ & $\neq$ & $\geq$ & $<$ & $=$ & $>$ & $\bot$ \\
		\hline
		$\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\bot$ \\
		$\leq$ & $\top$ & $\leq$ & $\top$ & $\top$ & $<$ & $\leq$ & $\top$ & $\bot$\\
		$\neq$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\neq$ & $\top$ & $\bot$ \\
		$\geq$ & $\top$ & $\top$ & $\top$ & $\geq$ & $\top$ & $\geq$ & $>$ & $\bot$\\
		$<$ & $\top$ & $<$ & $\top$ & $\top$ & $<$ & $<$ & $\top$ & $\bot$\\
		$=$ & $\top$ & $\leq$ & $\neq$ & $\geq$ & $<$ & $=$ & $>$ & $\bot$\\
		$>$ & $\top$ & $\top$ & $\top$ & $>$ & $\top$ & $>$ & $>$ & $\bot$ \\
		$\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$
	\end{tabular}
\end{center}

Osservando il numero di ricorrenze di $\top$ all'interno della tabella
e confrontandolo con quello all'interno della tabella
della moltiplicazione astratta, si nota che su questo dominio
la moltiplicazione astratta è più precisa della somma astratta.

\begin{definizione}\summary{Divisione intera astratta}
La divisione intera astratta viene definita come segue:
\[
	\absdiv = \lambda a_1,a_2 \in A . \alpha\bigl(\gamma(a_1) \condiv \gamma(a_2)\bigr)
\]
con $\condiv$ divisione intera concreta, definita come segue:
\[
	S_1 \condiv S_2 = \bigl\{\, n_1 / n_2 \mid n_1 \in S_1, n_2 \in S_2 \backslash \{0\} \,\bigr\}
\]
\end{definizione}
Nella seguente tabella, gli indici delle colonne indicano il dividendo e gli indici delle righe indicano il divisore.
\begin{center}
	\begin{tabular}{c | c c c c c c c c }
		$\absdiv$ & $\top$ & $\leq$ & $\neq$ & $\geq$ & $<$ & $=$ & $>$ & $\bot$ \\
		\hline
		$\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $=$ & $\top$ & $\bot$\\
		$\leq$ & $\top$ & $\geq$ & $\top$ & $\leq$ & $\geq$ & $=$ & $\leq$ & $\bot$\\
		$\neq$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $=$ & $\top$ & $\bot$\\
		$\geq$ & $\top$ & $\leq$ & $\top$ & $\geq$ & $\leq$ & $=$ & $\geq$ & $\bot$\\
		$<$ & $\top$ & $\geq$ & $\top$ & $\leq$ & $\geq$ & $=$ & $\leq$ & $\bot$\\
		$=$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$\\
		$>$ & $\top$ & $\leq$ & $\top$ & $\geq$ & $\leq$ & $=$ & $\geq$ & $\bot$\\
		$\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$
	\end{tabular}
\end{center}

\begin{definizione}\summary{Meno unario astratto}
Il meno unario astratto ($\absuminus$) può essere definito
per semplificare la definizione di meno binario astratto ($\abssub$).
Infatti l'operazione astratta:
\[
	a \abssub b
\]
può essere riscritta come:
\[
	a  \abssub b = a \absadd (\absuminus b)
\]
\end{definizione}

\begin{center}
	\begin{tabular}{ c | c c c c c c c c }
		$\absuminus$ & $\top$ & $\leq$ & $\neq$ & $\geq$ & $<$ & $=$ & $>$ & $\bot$ \\
		\hline
		  & $\top$ & $\geq$ & $\neq$ & $\leq$ & $>$ & $=$ & $<$ & $\bot$
	\end{tabular}
\end{center}

\section{Dominio astratto dei booleani}

Consideriamo ora come dominio astratto quello dei booleani.
[aggiungere immagine per dominio astratto dei booleani]

\section{Operazioni astratte su booleani}

Il dominio astratto dei booleani ci permette di ragionare
su altre operazioni astratte;
poiché si parla di booleani le operazioni interessanti
saranno quelle di confronto. 

\begin{definizione}\summary{Uguaglianza astratta}
\end{definizione}
\begin{center}
	\begin{tabular}{ c | c c c c c c c c }
		$\abseq$ & $\top$ & $\leq$ & $\neq$ & $\geq$ & $<$ & $=$ & $>$ & $\bot$ \\
		\hline
		$\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\bot$ \\
		$\leq$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $0$ & $\bot$\\
		$\neq$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $0$ & $\top$ & $\bot$\\
		$\geq$ & $\top$ & $\top$ & $\top$ & $\top$ & $0$ & $\top$ & $\top$ & $\bot$\\
		$<$ & $\top$ & $\top$ & $\top$ & $0$ & $\top$ & $\top$ & $0$ & $\bot$\\
		$=$ & $\top$ & $\top$ & $0$ & $\top$ & $0$ & $1$ & $0$ & $\bot$\\
		$>$ & $\top$ & $0$ & $\top$ & $\top$ & $0$ & $\top$ & $\top$ & $\bot$\\
		$\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$
	\end{tabular}
\end{center}


\begin{definizione}\summary{Diverso astratto}
Per definire l'operazione astratta di diverso basta definire quella di negato astratto:
\begin{align*}
	c_1 \neq c_2 &\iff \neg (c_2 = c_2) \\
	a_1 \absneq a_2 &\iff \absneg (a_1 =_a a_2)
\end{align*}
\end{definizione}

\begin{definizione}\summary{Disuguaglianza astratta}
Nella seguente tabella, gli indici delle colonne indicano
l'elemento a sinistra della disuguaglianza e gli indici delle righe
indicano l'elemento a destra.
\end{definizione}

\begin{center}
	\begin{tabular}{ c | c c c c c c c c }
		$\absleq$ & $\top$ & $\leq$ & $\neq$ & $\geq$ & $<$ & $=$ & $>$ & $\bot$ \\
		\hline
		$\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\bot$ \\
		$\leq$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $0$ & $\bot$ \\
		$\neq$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\top$ & $\bot$\\
		$\geq$ & $\top$ & $1$ & $\top$ & $\top$ & $1$ & $1$ & $\top$ & $\bot$ \\
		$<$ & $\top$ & $\top$ & $\top$ & $0$ & $\top$ & $0$ & $0$ & $\bot$\\
		$=$ & $\top$ & $1$ & $\top$ & $\top$ & $1$ & $1$ & $0$ & $\bot$ \\
		$>$ & $\top$ & $1$ & $\top$ & $\top$ & $1$ & $0$ & $\top$ & $\bot$ \\
		$\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$
	\end{tabular}
\end{center}

\subsection{Introduzione alla semantica astratta small-step}
Dopo aver definito le operazioni astratte,
definiamo una semantica astratta per $\AExp$, $\BExp$ e $\Com$.

\begin{definizione}\summary{Store astratto}
\[
	\fund{\Sigma^\#}{\Var}{A}
\]
\end{definizione}

\begin{definizione}\summary{Semantica astratta}
\[	
	\llbracket P \rrbracket (s) = s' \text{, se } \langle P, s \rangle \rightarrow^* \langle skip, s \rangle
\]
\end{definizione}

Ora abbiamo non determinismo:
\begin{align*}
	\llbracket \cdot \rrbracket^\# &: \Com^\# \mapsto (\Sigma^\# \rightarrowtail \Sigma^\#) \\
	\llbracket P \rrbracket^\# (s) &=  \sqcup _{\Sigma^\#} \bigl\{ s^\#_1 \in \Sigma^\# \mid \langle \alpha(P), s^\# \rangle \rightarrow \langle skip,\ s^\#_1 \rangle \bigr\}
\end{align*}

\begin{definizione}\summary{Ordinamento su $\Sigma^\#$}
\[
	\sqsubseteq\, \subseteq \Sigma^\# \times \Sigma^\#
\]
\end{definizione}
\begin{align*}
	\forall s_1^\#,\ s_2^\# \in \Sigma^\# : s_1^\# \sqsubseteq_{\Sigma^\#} s_2^\# \iff &\bigl(dom(s_1^\#) = dom(s_2^\#) \land \forall x \in dom(s_1^\#) : \\
	& s_1^\#(x) \sqsubseteq_\Sign s_2^\#(x) \bigr)
\end{align*}

\subsection{Semantica di $\AExp$}

\begin{center}
	(ABS-EXP.LEFT)
	\prooftree
		\langle E_1, s \rangle \rightarrow \langle E_1', s' \rangle
		\justifies
		\langle (E_1 + E_2), s \rangle \rightarrow \langle (E_1 + E_2'), s \rangle		
	\endprooftree
\end{center}

\begin{center}
	(ABS-EXP.RIGHT)
	\prooftree
		\langle E_2, s \rangle \rightarrow \langle E_2', s' \rangle
		\justifies
		\langle (a + E_2), s \rangle \rightarrow \langle (a + E_2'), s\rangle
	\endprooftree
\end{center}

\begin{center}
	(ABS-ADD)
	\prooftree
		\justifies
		\langle (a_1 + a_2), s \rangle \rightarrow \langle a_3, s \rangle 
		\using a_3 = a_1 \absadd a_2
	\endprooftree
\end{center}

\subsection{Semantica di $\BExp$}

\begin{definizione}\summary{And cortocircuitato astratto}
Prima di definire la semantica per le espressioni booleane,
definiamo un operatore di controllo cortocircuitato.
\end{definizione}

\begin{center}
	\begin{tabular}{ c | c c c c }
		$\absand$ & $\top$ & 1 & 0 & $\bot$ \\
		\hline
		$\top$ & $\top$ & $\top$ & 0 & $\bot$ \\
		1 & $\top$ & 1 & 0 & $\bot$ \\
		0 & 0 & 0 & 0 & $\bot$ \\
		$\bot$ & $\bot$ & $\bot$ & $\bot$ & $\bot$
	\end{tabular}
\end{center} 
\subsubsection{Semantica}
\begin{center}
	(AND-SHORT.LEFT)
	\prooftree
		\langle B_1, s \rangle \rightarrow \langle B_1', s' \rangle
		\justifies
		\langle (B_1 \land B_2), s \rangle \rightarrow \langle (B_1' \land B_2), s' \rangle
	\endprooftree
\end{center}

\begin{center}
	(AND-SHORT.TOP)
	\prooftree
		\langle B_2, s \rangle \rightarrow \langle B_2', s' \rangle
		\justifies
		\langle (\top \land B_2), s \rangle \rightarrow \langle (\top \land B_2'), s' \rangle
	\endprooftree
\end{center}

\begin{center}
	(AND-SHORT.TRUE)
	\prooftree
		\justifies
		\langle (1 \land B_2), s \rangle \rightarrow \langle B_2, s \rangle
	\endprooftree
\end{center}

\begin{center}
	(AND-SHORT.FALSE)
	\prooftree
		\justifies
		\langle (0 \land B_2), s \rangle \rightarrow \langle 0, s \rangle
	\endprooftree
\end{center}

\begin{center}
	(ABS-AND-SHORT.TOP)
	\prooftree
		\justifies
		\langle (\top \land b_2), s \rangle \rightarrow \langle (\top \absand b_2), s \rangle
	\endprooftree
\end{center}

\subsection{Semantica di $\Com$}

\begin{center}
	(ASSIGN)
	\prooftree
		\langle E, s \rangle \rightarrow \langle E', s' \rangle
		\justifies
		\langle x \weq E, s \rangle \rightarrow \langle x \weq E', s' \rangle
	\endprooftree
\end{center}

\begin{center}
	(ASSIGN-SKIP)
	\prooftree
		\justifies
		\langle x \weq a, s \rangle \rightarrow \langle \text{skip}, s[x \mapsto a] \rangle
	\endprooftree
\end{center}

\begin{center}
	(COND-BOOL)
	\prooftree
		\langle B, s \rangle \rightarrow \langle B', s' \rangle
		\justifies
		\langle \condif{B}{C_1}{C_2}, s \rangle \rightarrow \langle \condif{B'}{C_1}{C_2}, s' \rangle
	\endprooftree
\end{center}

\begin{center}
	(IF-TRUE)
	\prooftree
		\justifies
		\langle \condif{b}{C_1}{C_2}, s \rangle \rightarrow \langle C_1, s \rangle
		\using b \sqsubseteq_B 1
	\endprooftree
\end{center}

\begin{center}
	(IF-FALSE)
	\prooftree
		\justifies
		\langle \condif{b}{C_1}{C_2}, s \rangle \rightarrow \langle C_2, s \rangle
		\using b \sqsubseteq_B 0
	\endprooftree
\end{center}
